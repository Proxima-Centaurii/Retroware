/* TABLES */

CREATE TABLE CATEGORIES(
    category_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    title VARCHAR(25)
);

CREATE TABLE GAMES(
    game_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    title VARCHAR(25),
    description VARCHAR(150),
    play_count BIGINT,
    rating SMALLINT CHECK(rating >= 0 AND rating <= 100),
    unlisted CHAR(1) CHECK(unlisted = 'T' OR unlisted = 'F'),
    resource_id VARCHAR(32),
    publish_date DATE,
    CONSTRAINT unique_title UNIQUE (TITLE)
);

CREATE TABLE GAME_CATEGORIES(
    game_id INTEGER,
    category_id INTEGER,
    PRIMARY KEY(game_id, category_id),
    FOREIGN KEY(game_id) REFERENCES GAMES(game_id) ON DELETE CASCADE,
    FOREIGN KEY(category_id) REFERENCES CATEGORIES(category_id) ON DELETE CASCADE
);

CREATE TABLE WEEKLY_FEATURED_GAMES(
    game_id INTEGER PRIMARY KEY,
    FOREIGN KEY(game_id) REFERENCES GAMES(game_id) ON DELETE CASCADE
);

CREATE TABLE WEEKLY_POPULAR_GAMES(
    game_id INTEGER PRIMARY KEY,
    FOREIGN KEY(game_id) REFERENCES GAMES(game_id) ON DELETE CASCADE
);

CREATE TABLE APP_USERS(
    USER_ID INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
    USERNAME VARCHAR(25) UNIQUE,
    EMAIL VARCHAR(90) UNIQUE,
    PASSWORD_HASH VARCHAR(40),
    JOIN_DATE DATE,
    DESCRIPTION VARCHAR(200),
    BANNED CHAR(1) NOT NULL,
    SALT BLOB(16)
);

CREATE TABLE USER_PROFILE_PICTURES(
    USER_ID INTEGER PRIMARY KEY,
    IMAGE BLOB(2097152),
    IMAGE_FILE_NAME varchar(30),
    FOREIGN KEY (USER_ID) REFERENCES APP_USERS(USER_ID) ON DELETE CASCADE
);

CREATE TABLE GAME_RATINGS(
    GAME_ID INTEGER,
    USER_ID INTEGER,
    RATING SMALLINT CHECK(RATING >= -1 AND RATING <= 1),
    PRIMARY KEY(GAME_ID, USER_ID),
    FOREIGN KEY(GAME_ID) REFERENCES GAMES(GAME_ID) ON DELETE CASCADE,
    FOREIGN KEY(USER_ID) REFERENCES APP_USERS(USER_ID) ON DELETE CASCADE
);

CREATE TABLE LIKES_COUNT(
    GAME_ID INTEGER PRIMARY KEY,
    LIKES_COUNT INTEGER CHECK(LIKES_COUNT >= 0),
    DISLIKES_COUNT INTEGER CHECK(DISLIKES_COUNT >= 0),
    FOREIGN KEY(GAME_ID) REFERENCES GAMES(GAME_ID) ON DELETE CASCADE
);

CREATE TABLE COMMENTS(
    USER_ID INTEGER,
    GAME_ID INTEGER,
    COMMENT VARCHAR(150),
    FOREIGN KEY(USER_ID) REFERENCES APP_USERS(USER_ID) ON DELETE CASCADE,
    FOREIGN KEY(GAME_ID) REFERENCES GAMES(GAME_ID) ON DELETE CASCADE
);
